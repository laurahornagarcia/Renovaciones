@page "/"
@inject Ofertum.Renovaciones.Services.PriceProfileStore PriceProfileStore
@inject NavigationManager NavigationManager

<PageTitle>Procesar Oferta</PageTitle>

<h1>Procesar Oferta Excel</h1>

<form method="post" enctype="multipart/form-data" action="/api/process">
    <div class="form-group">
        <label for="file">Archivo Excel (.xlsx):</label>
        <input type="file" id="file" name="file" accept=".xlsx" class="form-control" required />
    </div>

    <div class="form-group mt-3">
        <label for="profileId">Perfil de Precios:</label>
        <select id="profileId" @onchange="UpdateProfileId" class="form-control">
            <option value="">-- Seleccione un perfil --</option>
            @foreach (var profile in Profiles)
            {
                <option value="@profile.Id">@profile.Name</option>
            }
        </select>
    </div>

    <div class="form-group mt-3">
        <label for="sequence">Secuencia Diaria:</label>
        <InputNumber id="sequence" name="sequence" @bind-Value="sequence" class="form-control" min="1" />
    </div>

    <button type="submit" class="btn btn-primary mt-4">Procesar y descargar</button>

    <input type="hidden" name="profileId" value="@hiddenProfileId" />
    <input type="hidden" name="sequence" value="@sequence" />
</form>

@code {
    private List<Ofertum.Renovaciones.Models.PriceProfile> Profiles { get; set; } = new List<Ofertum.Renovaciones.Models.PriceProfile>();
    private string? selectedProfileId { get; set; }
    private string? hiddenProfileId { get; set; }
    private int sequence { get; set; } = 1;

    protected override async Task OnInitializedAsync()
    {
        Profiles = await PriceProfileStore.ListAsync();
    }

    private void UpdateProfileId(ChangeEventArgs e)
    {
        hiddenProfileId = e.Value?.ToString();
        selectedProfileId = e.Value?.ToString();
    }
}
