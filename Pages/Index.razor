@page "/"
@inject Ofertum.Renovaciones.Services.PriceProfileStore PriceProfileStore
@inject NavigationManager NavigationManager

<PageTitle>Procesar Oferta</PageTitle>

<h1>Procesar Oferta Excel</h1>
<form method="post" enctype="multipart/form-data" action="/api/process">
    <div class="form-group">
        <label for="file">Archivo Excel (.xlsx):</label>
        <input type="file" id="file" name="file" accept=".xlsx" class="form-control" required />
    </div>

    <div class="form-group mt-3">
 

        <select id="profileId" name="profileId" class="form-control">
    <option value="">-- Seleccione un perfil --</option>
        @foreach (var profile in Profiles)
        {
            <option value="@profile.Id" selected="@(profile.Id == selectedProfileId)">
                @profile.Name
            </option>
        }
    </select>
    </div>

    <div class="form-group mt-3">
        <label for="sequence">Secuencia Diaria:</label>
        <input type="number" id="sequence" name="sequence" value="1" min="1" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary mt-4">Procesar y descargar</button>
</form>

@code {
    private List<Ofertum.Renovaciones.Models.PriceProfile> Profiles { get; set; } = new();
    private string? selectedProfileId;
 
    protected override async Task OnInitializedAsync()
{
    Profiles = (await PriceProfileStore.ListAsync())
        .OrderByDescending(p => p.UpdatedAtUtc)
        .ToList();

    selectedProfileId = Profiles.FirstOrDefault()?.Id; // el más nuevo
}

}